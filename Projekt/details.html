<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Car Details</title>
    <link rel="stylesheet" href="style.css" />
    <script
      src="https://kit.fontawesome.com/6a87383f2b.js"
      crossorigin="anonymous"
    ></script>
    <!-- Add any necessary CSS or external libraries -->
  </head>
  <body>
    <header>
      <nav>
        <div class="search-bar">
          <div class="logo">
            <img src="Gear logo.png" alt="Logo" />
          </div>
          <div class="search-bar2">
            <i class="fa-solid fa-magnifying-glass"></i>
            <input type="text" placeholder="Type here to search..." />
          </div>
          <button>Log in</button>
        </div>
      </nav>
      <div class="hamburgar-meny">
        <div class="hamburgarmeny">
          <img src="hamburgermenu-150x150.png" alt="Hamburgarmeny" />
        </div>
      </div>
    </header>
    <h1>Car Details</h1>

    <!-- Display car details here -->

    <div id="carImageContainer">
      <div id="carImage"></div>
      <div class="carTitle"></div>
    </div>
    <div id="carDescription"></div>
    <div id="carDetails"></div>

    <script>
      // Extract car brand from URL query parameters
      const urlParams = new URLSearchParams(window.location.search);
      const carBrand = urlParams.get("modelName");
      const modelName = carBrand.split(" ").pop(); // API tar bara model name, inte BMW X5 men "X5" gÃ¥r bra.

      // Use car brand to fetch additional information from the Ninja API
      const api_ninjas_key = "SMYcP8gAQ5Oqu0QQRbo3dw==Cn8ldHsxKNwhRaRU";
      const pexels_key =
        "63IRMceH21MoQsjJEHf74XKmrBFrf14acsLx9mJxvZ12TIn0CQMzP49s";
      const apiUrl = `https://api.api-ninjas.com/v1/cars?model=${modelName}`;

      fetch(apiUrl, {
        headers: {
          "X-Api-Key": api_ninjas_key,
        },
      })
        .then((response) => response.json())
        .then((data) => {
          const carDetailsDiv = document.getElementById("carDetails");
          const carDescriptionDiv = document.getElementById("carDescription");

          if (data.length > 0) {
            const car = data[0];
            const carDiv = document.createElement("div");
            carDiv.innerHTML = `
                    <h2>${car.model}</h2>
                    <p>Vehicle manufacturer: ${car.make}</p>
                    <p>Year: ${car.year}</p>
                    <p>Drive type: ${car.drive}</p>
                    <p>Fuel type: ${car.fuel_type}</p>
                    <p>Transmission: ${car.transmission}</p>
                    <p>Cylinders: ${car.cylinders}</p>
                    <!-- Add more information as needed -->
                `;
            carDetailsDiv.appendChild(carDiv);
          }

          if (data.length > 0) {
            const car = data[0];
            const carDiv = document.createElement("div");
            carDiv.innerHTML = `
            The ${car.make} ${car.model} is a ${car.class} with a fuel type of ${car.fuel_type}, a consumption of ${car.city_mpg} (miles per gallon).
            The ${car.make} ${car.model} made ${car.year} by ${car.make} is ${car.transmission} (transmission) and will suit every user differently.
            More specific this car has ${car.cylinders} cylinders
                `;
            carDescriptionDiv.appendChild(carDiv);
          }
          // Display car details on the page
          console.log("data is:", data); // Replace with your logic to display car details
        })
        .catch((error) => {
          console.error("Error fetching car information:", error);
        });

      const apiKey = pexels_key;
      fetch(`https://api.pexels.com/v1/search?query=${modelName}&per_page=1`, {
        headers: {
          Authorization: apiKey,
        },
      })
        .then((response) => response.json())
        .then((data) => {
          const carImageDiv = document.getElementById("carImage");
          const carImageContainerDiv =
            document.getElementById("carImageContainer");
          // const backgroundImageDiv = document.getElementById("backgroundImage");
          // Display the first image from the API response
          const carImage = data.photos[0];
          const imgElement = document.createElement("img");
          imgElement.src = carImage.src.medium;
          imgElement.alt = carImage.alt_description;

          carImageDiv.appendChild(imgElement);
          let bgImage = imgElement.cloneNode(true);

          bgImage.style.width = "100%";
          bgImage.style.height = "350px";
          bgImage.style.filter = "brightness(0.5) blur(4px)";
          carImageContainerDiv.appendChild(bgImage);

          // const foregroundImage = document.getElementById("foregroundImage");
          // foregroundImage.src = carImage.src.medium;

          // carImageDiv.style.backgroundImage = `url(${carImage.src.medium})`;
        })
        .catch((error) => {
          console.error("Error fetching car image:", error);
        });

      // Call fetchImages function when the page loads
      document.addEventListener("DOMContentLoaded", function () {
        fetchImages();
      });
      const searchInput = document.querySelector(".search-bar2 input");

      const searchIcon = document.querySelector(
        ".search-bar2 i.fa-magnifying-glass"
      );

      // Add event listener for keypress
      searchInput.addEventListener("keypress", function (event) {
        // Check if the pressed key is Enter
        if (event.key === "Enter") {
          // Prevent the default form submission behavior
          event.preventDefault();
          // Call the function to handle search
          handleSearch();
        }
      });

      searchIcon.addEventListener("click", function () {
        // Call the function to handle search
        handleSearch();
      });

      // Function to handle search
      function handleSearch() {
        // Get the search query from the input field
        const query = searchInput.value.trim();
        // Redirect to the details page with the search query as a parameter
        window.location.href = `details.html?modelName=${encodeURIComponent(
          query
        )}`;
      }
    </script>
  </body>
</html>
